/* Copyright (c) Ericsson 2016 */

define("chartlib/charts/_base/Grid",["chartlib/base/d3"],function(t){"use strict";return function(i,a){function r(){var t=F+"AxisClipPath-"+m.id,i=T+"AxisClipPath-"+m.id;w=x.append("clipPath"),w.attr("id",t).append("rect"),v=x.append("clipPath"),v.attr("id",i).append("rect"),b=k.append("g").attr("fill",V.theme.grid.axis.fill).attr("shape-rendering","geometricPrecision").attr("class","entriesAxisG").attr("clip-path","url(#"+t+")"),A=k.append("g").attr("fill",V.theme.grid.axis.fill).attr("shape-rendering","geometricPrecision").attr("class","valuesAxisG").attr("clip-path","url(#"+i+")"),P=k.append("g"),P.append("polygon").attr("points","0.331,-0.331 4.654,2.163 0.331,4.654").attr("fill",V.theme.grid.axis.fill),M=k.append("g"),M.append("polygon").attr("points","0,4.323 2.494,0 4.985,4.323").attr("fill",V.theme.grid.axis.fill)}function e(){B=x.append("clipPath"),B.attr("id","lineWrapperClipPath-"+m.id).append("rect").attr("class","lineWrapper"),S=k.append("g"),S.attr("clip-path","url(#lineWrapperClipPath-"+m.id+")")}function n(t){return V.grid.axisLabels[t]?k.append("g").attr("class",t+"AxisLabel").append("text").text(V.grid.axisLabels[t]).attr("fill",V.theme.grid.text.fill).attr("dy","0.75em").attr("text-anchor","middle"):void 0}function l(i){var a=V.grid.tickFormat[i],r=V.plotOptions.scaleType[i];if(a){var e;"string"==typeof a?e="time"===r?t.time.format(a):t.format(a):"function"==typeof a&&(e=a),G[i]=e}}function s(i,a,r,e,n){n=n||{};var l=p(T,a),s=V.grid.tickSize.y,o=a[y?"width":"height"],g=y?"bottom":"left",h=a.margins.left-3,m=a.margins.top-3,u=t.svg.axis().tickSize(1).tickPadding(V.grid.tickPadding.y).scale(r.y.nice()).orient(g);A.attr("transform","translate("+l.x+","+l.y+")"),v.selectAll("rect").attr("x",y?-12:-(s.width+12)).attr("y",-6).attr("width",Math.max(0,y?o+40:s.width+V.grid.gridPadding.left+12)).attr("height",Math.max(0,y?40:o+a.margins.left)),c(u,o,r.y.domain(),"y"),d(e)?A.transition().duration(e.duration).delay(e.delay).ease(V.animation.easing).call(u):A.call(u),A.selectAll("g.tick text").attr("fill",V.theme.grid.text.fill).style(V.theme.grid.tickStyles);var x=f(M);return(x.x!==h||x.y!==m)&&(d(e)?M.attr("transform","translate("+h+","+x.y+")").transition().duration(e.duration).delay(e.delay).ease(V.animation.easing).attr("transform","translate("+h+","+m+")"):M.attr("transform","translate("+h+","+m+")")),u}function o(i,a,r,e,n){n=n||{};var l,s,o=void 0!==r.groupedEntries,g=o||V.grid.gridPadding.left>0,h=V.grid.tickSize.x,u=V.grid.tickPadding.x,x=p(F,a),k=y?"left":"bottom",v=o?r.groupedEntries:r.x,A=a[y?"height":"width"]-V.grid.gridPadding.left,M=d(e),S=t.svg.axis().tickSize(g?0:1).tickPadding(u).scale(v).orient(k);c(S,A,v.domain(),"x");var B=C.x;o&&(l=r.x.domain(),s=r.groupedEntries.domain(),B=l.length*s.length);var z=y?h.width:(a.width-2*u*B)/B,E=Math.ceil(Math.min(z,h.width)),T=-E/2+V.grid.gridPadding.left,G=n.position&&void 0!==n.position.y?n.position.y:6,L=a.margins.left+a.width,W=a.margins.top+a.height-1.5;if(w.selectAll("rect").attr("x",y?-E:-25).attr("y",0).attr("width",Math.max(0,y?E:A+V.grid.gridPadding.left+50)).attr("height",Math.max(0,y?A+40:40)),b.attr("transform","translate("+x.x+","+x.y+")"),g){var H=b.selectAll("line"),O=0,j=a.width,D=0,I=0;H.empty()&&(H=b.append("line").attr("stroke-width",1).attr("stroke",V.theme.grid.axis.fill)),y&&(O=-V.grid.gridPadding.left-1,j=-V.grid.gridPadding.left-1,I=a.height),H.attr("x1",O).attr("y1",D).attr("y2",I),M?H.transition().duration(e.duration).delay(e.delay).ease(V.animation.easing).attr("x2",j):H.attr("x2",j)}if(o){var _=function(t){var i=n.group.getGroupCoords(t);return"translate("+i.x+","+i.y+")"},q=function(t){var i=n.group.getTickCoords(t);return y&&(i.y+=G),"translate("+i.x+","+i.y+")"},J=b.selectAll("g.group"),K=J.data(l.map(function(t){return{label:t}}));K.enter().append("g").attr("class","group").attr("transform",_).call(function(){var t=this.selectAll("g.tick").data(s.map(function(t){return{label:t}}));t.enter().append("g").attr("class","tick").append("text").text(function(t){return t.label})}),K.exit().remove(),M?b.selectAll("g.group").transition().duration(e.duration).delay(e.delay).ease(V.animation.easing).attr("transform",_).call(function(){this.selectAll("g.tick").attr("transform",q)}):b.selectAll("g.group").attr("transform",_).call(function(){this.selectAll("g.tick").attr("transform",q)})}else M?b.transition().duration(e.duration).delay(e.delay).ease(V.animation.easing).call(S):b.call(S);y&&(T=-E,G=-h.height/2,V.theme.grid.tickStyles["text-align"]="left"),b.selectAll("g.tick").call(function(t){m.wrapTextEllipsis(t,{},{})}),b.selectAll("g.tick .wrappingFobj").attr("x",T).attr("y",G).attr("width",Math.max(0,E)).attr("height",Math.max(0,h.height)),b.selectAll("g.tick .wrappedText").style(V.theme.grid.tickStyles).style("color",V.theme.grid.text.fill);var N=f(P);return(N.x!==L||N.y!==W)&&(M?P.attr("transform","translate("+N.x+","+W+")").transition().duration(e.duration).delay(e.delay).ease(V.animation.easing).attr("transform","translate("+L+","+W+")"):P.attr("transform","translate("+L+","+W+")")),S}function d(t){return t.duration+t.delay>0}function g(t,i,a,r){B.selectAll("rect").attr("width",Math.max(0,i.width)).attr("height",Math.max(0,i.height-1)),S.attr("transform","translate("+i.margins.left+","+i.margins.top+")");var e=S.selectAll("line.gridline").data(a.y.ticks(C.y)),n=0,l=i.width,s=a.y,o=a.y;y&&(n=a.y,l=a.y,s=0,o=i.height),e.attr("class","update gridline").transition().duration(r.duration).delay(r.delay).ease(V.animation.easing).attr("opacity","1").attr("x1",n).attr("x2",l).attr("y1",s).attr("y2",o);var g=e.enter().append("line").attr("class","enter gridline").attr("x1",n).attr("x2",l).attr("y1",s).attr("y2",o).attr("shape-rendring","crispEdges").attr("stroke",V.theme.grid.stroke.fill).attr("stroke-dasharray",V.theme.grid.stroke.dashArray);d(r)&&g.attr("opacity","0").transition().duration(r.duration).delay(r.delay).ease(V.animation.easing).attr("opacity","1"),e.exit().transition().duration(.5*r.duration).delay(r.delay).ease(V.animation.easing).attr("opacity","0").remove()}function c(t,i,a,r){var e=V.grid,n=e.tickValues[r],l=e.tickHint[r],s=e.tickSize[r]["x"===r?"width":"height"],o=V.plotOptions.scaleType[r];if("number"==typeof l||"ordinal"!==o&&"auto"!==l)if("number"==typeof l)t.ticks(l),C[r]=l;else if(n===!0){var d=a.filter(function(t,i){return i%V.grid.dataItemsPerTick.x===0});t.tickValues(d),C[r]=d.length}else n!==!1&&(t.tickValues(n),C[r]=n.length);else{var g=Math.round(Math.max(i,1)/s);e.tickHint.max[r]&&(g=Math.min(e.tickHint.max[r],g)),t.ticks(g),C[r]=g}void 0!==G[r]&&t.tickFormat(G[r])}function h(t){var i=y?E:z,a=y?z:E;if(void 0!==i){var r=t.margins.left+t.width/2,e=t.margins.top+t.height+b.node().getBBox().height;V.grid.tickPadding.x>i.node().getBBox().height&&(e=V.chart.height-V.chart.margin.bottom-i.node().getBBox().height),y&&(e=t.margins.top+t.height+(A.node().getBBox().height+6)),i.attr("transform","translate("+r+","+e+")")}if(void 0!==a){var n=V.chart.margin.left,l=parseFloat(t.height/2)+t.margins.top;a.attr("transform","translate("+n+","+l+") rotate(-90)")}}function p(t,i){var a={x:i.margins.left,y:i.margins.top+i.height},r={x:i.margins.left,y:i.margins.top};return t===F?y?r:a:y?a:r}function f(i){var a=t.transform(i.attr("transform"));return{x:a.translate[0],y:a.translate[1]}}var m,u,x,y,k,v,w,A,b,P,M,S,B,z,E,F="entries",T="values",C={},G={},L=0,V={theme:{grid:{tickStyles:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis",margin:"0","font-weight":"normal","word-wrap":"break-word","text-align":"center"}}},grid:{axisLabels:{x:!1,y:!1},axisWidth:{y:!1},dataItemsPerTick:{x:1},gridPadding:{left:0,right:0},tickFormat:{x:!1,y:!1},tickHint:{x:"auto",y:"auto",max:{x:8,y:5}},tickPadding:{x:8,y:8},tickSize:{x:{height:20,width:75},y:{height:20,width:40},overflow:{x:"ellipsis",y:"ellipsis"}},tickValues:{x:!1,y:!1}}};this.init=function(){if(m=a,y="horizontal"===m.options.plotOptions.orientation,i.grid===!0){var t=V.grid;V=m.objectMerger(V,i),V.grid=t}else V=m.objectMerger(V,i);u=m.svg,x=m.defs,k=u.append("g"),k.attr("id","gridWrapper-"+m.id),r(),e(),z=n("x"),E=n("y"),l("x"),l("y"),this.yAxisSize=V.grid.axisWidth.y},this.getOptions=function(){return V.grid},this.getEntriesAxisLabelSize=function(){return void 0!==z?z.node().getBBox():void 0},this.getValuesAxisLabelSize=function(){return void 0!==E?E.node().getBBox():void 0},this.getEntriesAxisFormat=function(){return G.x},this.getValuesAxisFormat=function(){return G.y},this.update=function(t,i,a,r){var e={duration:L>0?V.animation.transitionDuration:0,delay:L>0?V.animation.transitionDelay:0};s(t,i,a,e,r),o(t,i,a,e,r),g(t,i,a,e),h(i),L++},this.init()}}),define("chartlib/charts/Grid",["chartlib/charts/_base/Grid"],function(t){return t});
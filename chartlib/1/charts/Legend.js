/* Copyright (c) Ericsson 2016 */

define("chartlib/charts/_base/Legend",["chartlib/base/d3"],function(e){"use strict";return function(t,n){var i,r,s,a={legend:{align:"bottom",centered:!1,icons:!0,circleRadius:5}};this.init=function(){if(i=n,t.legend===!0){var e=a.legend;a=i.objectMerger(a,t),a.legend=e}else a=i.objectMerger(a,t);this.align=a.legend.align,this.circleRadius=a.legend.circleRadius,this.circleDistance=10,this.xPositions=!1,r=i.svg,s=i.defs,this.legendWrapper=r.append("g").attr("id","legendWrapper-"+i.id)},this.update=function(e,t){this._legendData=e;var n=this.createLegendItems(e);"bottom"===this.align?this.xPositions!==!1?this.positionLegendItemsAfterXPositions(n,t):this.positionLegendItemsAtBottom(n,t):"right"===this.align&&this.positionLegendItemsAtRight(n,t)},this.createLegendItems=function(e){var t,n=a.legend.icons===!0?2*a.legend.circleRadius+this.circleDistance:0,r=this.legendWrapper.selectAll("g.legendItem").data(e),s=void 0!==a.legend.events,l=function(e,t){return{context:this,entry:e,index:t}},o=e.filter(function(e){return e.visible!==!1}).length;if(r.enter().append("g").attr("class","legendItem").style("pointer-events",function(){return s?"all":"inherit"}),r.exit().remove(),r.style("opacity",function(e){return e.visible===!1?.4:1}).style("cursor",function(e){return!s||e.visible!==!1&&e.visible!==!1&&1===o?"inherit":"pointer"}),(s||void 0!==a.legend.tooltip)&&r.on("click",function(){var e=l.apply(this,arguments);e.type=a.legend.events?a.legend.events.click:void 0,i.getEventBus().publish("legend:click",e)}).on("mousemove",function(){i.getEventBus().publish("legend:mousemove",l.apply(this,arguments))}).on("mouseout",function(){i.getEventBus().publish("legend:mouseout",l.apply(this,arguments))}),t=r.selectAll("text.legendLabel").data(function(e){return[e]}),t.enter().append("text").attr("class","enter legendLabel").attr("fill",a.theme.legend.text.fill).attr("dy","0.75em").attr("font-size",a.theme.legend.text.fontSize).attr("transform","translate("+n+",0)"),t.text(function(e){return e.label}),a.legend.icons===!0){var c=r.selectAll("circle.legendIcon").data(function(e){return[e]});c.enter().append("circle").attr("r",a.legend.circleRadius).attr("transform","translate("+a.legend.circleRadius+","+(a.legend.circleRadius-1)+")").attr("class","enter legendIcon"),c.attr("fill",function(e){return i.colorScale(e.label,e)})}return r},this.positionLegendItemsAtBottom=function(t,i){var r=0,s=0;t.each(function(){var t=e.select(this),n=this.getBBox();r+n.width>i.width&&(r=0,s+=n.height+5),t.attr("transform","translate("+r+","+s+")"),r+=n.width+20});var l=this.legendWrapper.node().getBBox(),o=n.getSize(),c=a.legend.centered===!0?(i.width-l.width)/2+i.margins.left:i.margins.left,g=o.height-a.chart.margin.bottom-this.legendWrapper.node().getBBox().height;this.legendWrapper.attr("transform","translate("+c+", "+g+")")},this.positionLegendItemsAtRight=function(t,n){var i=0;t.each(function(){var t=e.select(this);t.attr("transform","translate(0,"+i+")"),i+=this.getBBox().height+10});var r=this.legendWrapper.node().getBBox(),s=a.legend.centered===!0?(n.height-r.height)/2+n.margins.top:n.margins.top;this.legendWrapper.attr("transform","translate("+(n.margins.left+n.width+10)+", "+s+")")},this.positionLegendItemsAfterXPositions=function(t,n){this.legendWrapper.attr("transform","translate("+n.margins.left+", "+(n.margins.top+n.height+10)+")");var r=this.xPositions;t.call(function(e){i.wrapTextEllipsis(e,{})}),t.each(function(t,n){var i=e.select(this);i.attr("transform","translate("+r[n].x+",0)"),i.selectAll(".wrappingFobj").attr("width",Math.max(0,Math.ceil(r[n].w)))}),this.legendWrapper.selectAll("g.legendItem .wrappedText").each(function(t,n){var i=e.select(this);i.style({"line-height":"1.2rem","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","text-align":"center",margin:"0","font-weight":"normal","word-wrap":"break-word",width:Math.ceil(r[n].w)+"px"})})},this.getLegendData=function(){return this._legendData},this.init()}}),define("chartlib/charts/Legend",["chartlib/charts/_base/Legend"],function(e){return e});
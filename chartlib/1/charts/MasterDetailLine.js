/* Copyright (c) Ericsson 2016 */

define("styles!chartlib/charts/masterdetailline/_masterDetailLine.less",function(){return".elChartlib-wMasterDetailLine {\n  position: relative;\n  height: 100%;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  user-select: none;\n  cursor: default;\n}\n.elChartlib-wMasterDetailLine-master {\n  position: relative;\n}\n.elChartlib-wMasterDetailLine-master .elChartlib-wMasterDetailLine-slidingWindow,\n.elChartlib-wMasterDetailLine-master .elChartlib-wMasterDetailLine-overviewChart {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  padding: 0 36px;\n}\n"}),define("text!chartlib/charts/masterdetailline/_masterDetailLine.html",function(){return'<div class="elChartlib-wMasterDetailLine">\n    <section class="elChartlib-wMasterDetailLine-detail"></section>\n    <section class="elChartlib-wMasterDetailLine-master">\n        <div class="elChartlib-wMasterDetailLine-overviewChart"></div>\n        <div class="elChartlib-wMasterDetailLine-slidingWindow"></div>\n    </section>\n</div>'}),define("chartlib/charts/masterdetailline/MasterDetailLineView",["jscore/core","text!./_masterDetailLine.html","styles!./_masterDetailLine.less"],function(t,e,i){"use strict";var n=".elChartlib-wMasterDetailLine";return t.View.extend({CLASS_NAME:n.substring(0),getTemplate:function(){return e},getStyle:function(){return i},getDetailHolder:function(){return this.getElement().find(n+"-detail")},getMasterHolder:function(){return this.getElement().find(n+"-master")},getMasterOverviewChartHolder:function(){return this.getElement().find(n+"-overviewChart")},getMasterWindowHolder:function(){return this.getElement().find(n+"-slidingWindow")}})}),define("chartlib/charts/masterdetailline/MasterDetailLine",["jscore/core","jscore/base/jquery","jscore/ext/privateStore","chartlib/base/d3","chartlib/charts/Line","chartlib/widgets/SlidingWindow","./MasterDetailLineView"],function(t,e,i,n,a,r,s){"use strict";function l(t){b(this).data=t}function o(){return{min:b(this).minX,max:b(this).maxX}}function h(){var t=this.getData();b(this).minX=n.min(t,function(t){return n.min(t.data.map(function(t){return void 0!==t.x?t.x:t.label}))}),b(this).maxX=n.max(t,function(t){return n.max(t.data.map(function(t){return void 0!==t.x?t.x:t.label}))})}function d(){v.call(this)}function c(t){var e=this.getData().map(function(e){return{label:e.label,visible:e.visible,data:e.data.filter(function(e){var i=void 0!==e.x?e.x:e.label;return i>=t.start&&i<=t.end})}});if(b(this).displayRange=t,void 0===b(this).detailsLineChart){var i=this.options,n={};Object.keys(this.options).forEach(function(t){n[t]=i[t]}),n.chart=n.chart?n.chart:{margin:{left:5,right:5,bottom:5}},n.element=this.view.getDetailHolder(),n.data=e,n.legend=!1,b(this).detailsLineChart=new a(n)}else b(this).detailsLineChart.update(e)}function u(t){var e=w(t,L);e.element=this.view.getMasterOverviewChartHolder();var i=new a(e);i.addEventHandler("domattach",function(){requestAnimationFrame(v.bind(this))}.bind(this)),i.getEventBus().subscribe("legend:click",function(){l.call(this,i.data),this.trigger(this.VIEW_CHANGE,b(this).displayRange)}.bind(this)),b(this).masterLineChart=i}function g(t){var e=new r({overlay:t.overview.overlay||p});e.attachTo(this.view.getMasterWindowHolder()),e.addEventHandler("change",function(t){var e=o.call(this),i=e.max-e.min,n=e.min+i/100*t.start,a=e.min+i/100*t.end,r={start:n,end:a};this.trigger("display-range:change",r)}.bind(this)),b(this).slidingWindow=e}function v(){var t=b(this).masterLineChart.getElement().find(".lineWrapper");if(void 0!==t){var e=parseFloat(t.getAttribute("height"));this.view.getMasterWindowHolder().setStyle({height:e+L.chart.margin.top})}}function m(t){var e=b(this).slidingWindow;requestAnimationFrame(function(){e.trigger("change",t.overview.overlay||p)})}function f(t){var e=t.overview.master.height;this.view.getMasterHolder().setStyle({height:e}),this.view.getDetailHolder().setStyle({height:"calc(100% - "+e+")"})}function w(t,i){var n={};return e.extend(!0,n,t,i),n}var b=i.create(),p={start:40,end:60},D={overview:{overlay:void 0,master:{height:"30%"}}},L={theme:{plotOptions:{line:{lineWidth:1}}},chart:{margin:{top:0,right:5,bottom:5,left:0}},plotOptions:{line:{datalabels:!1}},grid:{tickSize:{y:{width:0}}},tooltip:!1};return t.Widget.extend({View:s,VIEW_CHANGE:"display-range:change",onViewReady:function(){var e=this.options.element,i=w(D,this.options);this.options=i,this.attachTo(e),l.call(this,i.data),h.call(this),u.call(this,i),b(this).windowResizeEvt=t.Window.addEventHandler("resize",d.bind(this))},onDestroy:function(){t.Window.removeEventHandler(b(this).windowResizeEvt)},onDOMAttach:function(){var t=this.options,e=this.getElement().getProperty("offsetHeight");0===e&&this.getElement().setStyle({height:a.prototype.baseHeight+"px"}),f.call(this,t),this.addEventHandler(this.VIEW_CHANGE,c.bind(this)),g.call(this,t),m.call(this,t)},getData:function(){return b(this).data},update:function(t){l.call(this,t),h.call(this),b(this).masterLineChart.update(t),this.trigger(this.VIEW_CHANGE,b(this).displayRange)}})}),define("chartlib/charts/MasterDetailLine",["chartlib/charts/masterdetailline/MasterDetailLine"],function(t){return t});
/* Copyright (c) Ericsson 2016 */

define("chartlib/widgets/ext/chartUtilsExt",["chartlib/base/d3"],function(t){"use strict";function i(t){s.call(this,t);var i=a.getLegendPosition(this.settings);n.call(this,i),h.call(this,i)}function e(){this.legendBlock&&this.legendBlock.remove(),this.legendBlock=this.svg.append("g")}function s(t){this.legend&&this.legend.remove(),this.legend=this.legendBlock.selectAll(".legend").data(this.pie(t)).enter().append("g").attr("class","legend").attr("transform",function(t,i){return"translate(0,"+20*i+")"})}function n(t){this.points&&this.points.remove(),this.points=this.legend.append("rect").attr("x",t).attr("width",10).attr("height",10).attr("y",5).style("fill",function(t,i){return this.colorPalette(i)}.bind(this)).attr("title",function(t){return t.data.label})}function h(t){this.labels&&this.labels.remove(),this.labels=this.legend.append("foreignObject").attr("x",t+15).attr("y",4).attr("width",this.settings.legendWidth-15+"px").attr("height","18px"),this.labels.append("xhtml:div").style({width:this.settings.legendWidth-15+"px","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden","text-align":"left","font-size":"1.2rem","line-height":"1.2rem"}).attr("title",function(t){return t.data.label}).text(function(t){return t.data.label})}var a={};return a.arcTween=function(i,e){var s=t.interpolate(this._current[e],i);return this._current[e]=s(0),function(t){return this.arc(s(t))}.bind(this)},a.getChartCenterX=function(t){return(t.width-t.legendWidth-t.padding)/2},a.getChartCenterY=function(t){return Math.min(t.width-t.legendWidth-t.padding,t.height)/2},a.getLegendPosition=function(t){return a.getChartCenterX(t)+t.radius+t.padding},a.createLegend=function(t){e.call(this),i.call(this,t)},a.updateLegend=function(t){i.call(this,t)},a}),define("chartlib/widgets/piechart/ext/PieChartExt",["chartlib/base/d3","chartlib/widgets/ext/chartUtilsExt","chartlib/main"],function(t,i,e){"use strict";function s(t){return t.radius=Math.min(t.width-t.legendWidth-2*t.padding,t.height)/2,t.outerRadius=0,t.innerRadius=t.radius,t}function n(t){this.slices&&this.slices.remove(),this.slices=this.chart.selectAll("g.slice").data(this.pie(t)).enter().append("g").attr("class","slice").style(this.settings.strokeStyles),this.paths&&this.paths.remove(),this.paths=this.slices.append("path").attr("fill",function(t,i){return this.colorPalette(i)}.bind(this)).attr("title",function(t){return t.value}).attr("d",this.arc).each(function(t,i){this._current[i]=t}.bind(this))}return e.extend({init:function(e){this.attach(e.parent);var h=this.getD3Element();this.settings={width:420,height:300,padding:10,legendWidth:120,colorPalette:"eriRainbow",animation:{duration:1e3,easeType:"cubic-in-out"},labelText:{styles:{fill:"#333333","font-size":"1.2rem","font-weight":"normal"}},strokeStyles:{stroke:"#EEEEEE","stroke-width":"2px"}},this.settings=this.mergeProperties(this.settings,e.settings),this.settings=s.call(this,this.settings),this.colorPalette=this.getColorsPalette(this.settings.colorPalette),this.dataset=e.data||{items:[]},this.itemsLength=this.dataset.items.length,this._current=[],this.svg=h.append("svg").attr("width",this.settings.width).attr("height",this.settings.height),this.chart=this.svg.append("g").attr("transform","translate("+i.getChartCenterX(this.settings)+","+i.getChartCenterY(this.settings)+")"),this.arc=t.svg.arc().outerRadius(this.settings.outerRadius).innerRadius(this.settings.innerRadius),this.pie=t.layout.pie().sort(null).value(function(t){return t.value}),this.itemsLength>0&&(n.call(this,this.dataset.items),i.createLegend.call(this,this.dataset.items))},update:function(t){!this.slices&&!this.legendBlock&&t.items.length>0||this.itemsLength!==t.items.length?(n.call(this,t.items),i.createLegend.call(this,t.items)):(i.updateLegend.call(this,t.items),this.paths.data(this.pie(t.items)),this.paths.transition().ease(this.settings.animation.easeType).duration(this.settings.animation.duration).attr("d",this.arc).attr("title",function(t){return t.value}).attrTween("d",i.arcTween.bind(this))),this.dataset=t,this.itemsLength=t.items.length},redraw:function(t){this.settings=this.mergeProperties(this.settings,t),this.settings=s(this.settings),this.colorPalette=this.getColorsPalette(this.settings.colorPalette),this.resize({width:this.settings.width,height:this.settings.height}),this.slices&&(this.slices.style(this.settings.strokeStyles),this.paths.attr("fill",function(t,i){return this.colorPalette(i)}.bind(this)).attr("d",this.arc)),this.points&&this.points.style("fill",function(t,i){return this.colorPalette(i)}.bind(this))},resize:function(t){if(this.settings.width=t.width?t.width:this.settings.width,this.settings.height=t.height?t.height:this.settings.height,this.settings=s(this.settings),this.arc.innerRadius(this.settings.innerRadius).outerRadius(this.settings.outerRadius),this.svg.attr("width",this.settings.width).attr("height",this.settings.height),this.chart.attr("transform","translate("+i.getChartCenterX(this.settings)+","+i.getChartCenterY(this.settings)+")"),this.slices&&(this.slices.selectAll("path").attr("d",this.arc),this.slices.selectAll("text").attr("transform",function(t){return t.innerRadius=this.settings.innerRadius,t.outerRadius=this.settings.outerRadius,"translate("+this.arc.centroid(t)+")"}.bind(this))),this.legendBlock){var e=i.getLegendPosition(this.settings);this.legend.selectAll("rect").attr("x",e),this.labels.attr("x",e+15)}}})}),define("chartlib/widgets/piechart/PieChart",["jscore/core","./ext/PieChartExt"],function(t,i){"use strict";return t.Widget.extend({init:function(t){this.options=t||{}},onViewReady:function(){this.pie=new i({parent:this.getElement(),settings:this.options.settings,data:this.options.data})},update:function(t){this.pie.update(t)},redraw:function(t){this.pie.redraw(t)},resize:function(t){this.pie.resize(t)}})}),define("chartlib/widgets/PieChart",["chartlib/widgets/piechart/PieChart"],function(t){return t});
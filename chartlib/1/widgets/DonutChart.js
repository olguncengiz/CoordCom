/* Copyright (c) Ericsson 2016 */

define("chartlib/widgets/ext/chartUtilsExt",["chartlib/base/d3"],function(t){"use strict";function e(t){s.call(this,t);var e=r.getLegendPosition(this.settings);n.call(this,e),h.call(this,e)}function i(){this.legendBlock&&this.legendBlock.remove(),this.legendBlock=this.svg.append("g")}function s(t){this.legend&&this.legend.remove(),this.legend=this.legendBlock.selectAll(".legend").data(this.pie(t)).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"})}function n(t){this.points&&this.points.remove(),this.points=this.legend.append("rect").attr("x",t).attr("width",10).attr("height",10).attr("y",5).style("fill",function(t,e){return this.colorPalette(e)}.bind(this)).attr("title",function(t){return t.data.label})}function h(t){this.labels&&this.labels.remove(),this.labels=this.legend.append("foreignObject").attr("x",t+15).attr("y",4).attr("width",this.settings.legendWidth-15+"px").attr("height","18px"),this.labels.append("xhtml:div").style({width:this.settings.legendWidth-15+"px","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden","text-align":"left","font-size":"1.2rem","line-height":"1.2rem"}).attr("title",function(t){return t.data.label}).text(function(t){return t.data.label})}var r={};return r.arcTween=function(e,i){var s=t.interpolate(this._current[i],e);return this._current[i]=s(0),function(t){return this.arc(s(t))}.bind(this)},r.getChartCenterX=function(t){return(t.width-t.legendWidth-t.padding)/2},r.getChartCenterY=function(t){return Math.min(t.width-t.legendWidth-t.padding,t.height)/2},r.getLegendPosition=function(t){return r.getChartCenterX(t)+t.radius+t.padding},r.createLegend=function(t){i.call(this),e.call(this,t)},r.updateLegend=function(t){e.call(this,t)},r}),define("chartlib/widgets/donutchart/ext/DonutChartExt",["chartlib/base/d3","chartlib/widgets/ext/chartUtilsExt","chartlib/main"],function(t,e,i){"use strict";function s(t){return t.radius=Math.min(t.width-t.legendWidth-2*t.padding,t.height)/2,t.innerRadius=t.radius-t.thickness,t.outerRadius=t.radius,t}function n(t){this.arcs&&this.arcs.remove(),this.arcs=this.chart.selectAll("path").data(this.pie(t)).enter().append("path").attr("fill",function(t,e){return this.colorPalette(e)}.bind(this)).attr("title",function(t){return t.value}).attr("d",this.arc).each(function(t,e){this._current[e]=t}.bind(this))}return i.extend({init:function(i){this.attach(i.parent);var h=this.getD3Element();this.settings={width:300,height:150,thickness:30,legendWidth:120,padding:10,animation:{duration:1e3,easeType:"cubic-in-out"},labelText:{styles:{fill:"#333333","font-size":"1.2rem","font-weight":"normal"}},centerText:{styles:{fill:"#333333","font-size":"5rem","font-weight":"normal","font-family":"EricssonCapitalTT"},heightTransform:15},colorPalette:"eriRainbow"},this.settings=this.mergeProperties(this.settings,i.settings),this.settings=s.call(this,this.settings),this.colorPalette=this.getColorsPalette(this.settings.colorPalette),this.dataset=i.data||{items:[]},this.itemsLength=this.dataset.items.length,this._current=[],this.svg=h.append("svg").attr("width",this.settings.width).attr("height",this.settings.height),this.chart=this.svg.append("g").attr("transform","translate("+e.getChartCenterX(this.settings)+","+e.getChartCenterY(this.settings)+")"),this.arc=t.svg.arc().innerRadius(this.settings.innerRadius).outerRadius(this.settings.outerRadius),this.pie=t.layout.pie().sort(null).value(function(t){return t.value}),this.settings.centerText&&(this.text=this.chart.append("text").attr("text-anchor","middle").style(this.settings.centerText.styles).attr("transform","translate(0, "+this.settings.centerText.heightTransform+")"),this.dataset.centerText&&this.text.text(this.dataset.centerText)),this.itemsLength>0&&(n.call(this,this.dataset.items),e.createLegend.call(this,this.dataset.items))},update:function(t){!this.arcs&&t.items.length>0||this.itemsLength!==t.items.length?(n.call(this,t.items),e.createLegend.call(this,t.items)):(e.updateLegend.call(this,t.items),this.arcs.data(this.pie(t.items)),this.arcs.transition().ease(this.settings.animation.easeType).duration(this.settings.animation.duration).attr("d",this.arc).attr("title",function(t){return t.value}).attrTween("d",e.arcTween.bind(this))),t.centerText&&this.text&&this.text.text(t.centerText),this.dataset=t,this.itemsLength=t.items.length},redraw:function(t){this.settings=this.mergeProperties(this.settings,t),this.settings=s(this.settings),this.colorPalette=this.getColorsPalette(this.settings.colorPalette),this.resize({width:this.settings.width,height:this.settings.height}),this.settings.centerText?this.text?this.text.attr("transform","translate(0, "+this.settings.centerText.heightTransform+")"):(this.text=this.chart.append("text").attr("text-anchor","middle").style(this.settings.centerText.styles).attr("transform","translate(0, "+this.settings.centerText.heightTransform+")"),this.dataset.centerText&&this.text.text(this.dataset.centerText)):this.text&&(this.text.remove(),delete this.text),this.arcs&&this.arcs.attr("fill",function(t,e){return this.colorPalette(e)}.bind(this)).attr("d",this.arc),this.points&&this.points.style("fill",function(t,e){return this.colorPalette(e)}.bind(this))},resize:function(t){if(this.settings.width=t.width?t.width:this.settings.width,this.settings.height=t.height?t.height:this.settings.height,this.settings=s(this.settings),this.svg.attr("width",this.settings.width).attr("height",this.settings.height),this.chart.attr("transform","translate("+e.getChartCenterX(this.settings)+","+e.getChartCenterY(this.settings)+")"),this.arc.innerRadius(this.settings.innerRadius).outerRadius(this.settings.outerRadius),this.arcs&&this.arcs.attr("d",this.arc),this.legendBlock){var i=e.getLegendPosition(this.settings);this.legend.selectAll("rect").attr("x",i),this.labels.attr("x",i+15)}}})}),define("chartlib/widgets/donutchart/DonutChart",["jscore/core","./ext/DonutChartExt"],function(t,e){"use strict";return t.Widget.extend({init:function(t){this.options=t||{}},onViewReady:function(){this.donut=new e({parent:this.getElement(),settings:this.options.settings,data:this.options.data})},update:function(t){this.donut.update(t)},redraw:function(t){this.donut.redraw(t)},resize:function(t){this.donut.resize(t)}})}),define("chartlib/widgets/DonutChart",["chartlib/widgets/donutchart/DonutChart"],function(t){return t});
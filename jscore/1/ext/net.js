/* Copyright (c) Ericsson 2016 */

define("jscore/ext/net",["jscore/core"],function(e){"use strict";var t={};return t.ajax=function(t){var a,r=new XMLHttpRequest,n=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,s=n.exec(window.location.href.toLowerCase());t=t||{};var o=function(){var a=r.responseText;t.success&&("json"===t.dataType&&(a=JSON.parse(a)),"xml"===t.dataType&&(a=(new DOMParser).parseFromString(a,"text/xml")),t.success.call(null,a,new e.XHR(r)))},c=function(){t.error&&t.error.call(null,r.statusText,new e.XHR(r))},u=function(e){if("object"==typeof e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")}return e};a={success:o,error:c,type:"GET",dataType:"text",url:window.location.host+window.location.pathname,processData:!0};var i=["statusCode","processData","cache","data","contentType","dataType","type","url","headers","withCredentials"];for(var d in t)i.indexOf(d)>-1&&(a[d]=t[d]);"GET"!==a.type&&void 0!==a.data&&void 0===a.contentType&&(a.headers&&a.headers["Content-Type"]||(a.contentType="application/x-www-form-urlencoded; charset=UTF-8"));var p=function(e){var t=!1;return function(){t||(a.statusCode&&a.statusCode[r.status]&&a.statusCode[r.status](),r.status>=200&&r.status<300||304===r.status?a.success():a.error(),t=!0)}},l=null;a.processData?"GET"===a.type&&a.data?-1===a.url.indexOf("?")?a.url+="?"+u(a.data):a.url+="&"+u(a.data):"object"==typeof a&&(l=u(a.data)):a.data&&(l=a.data),r.open(a.type,a.url,!0);var f=n.exec(a.url),v=f&&(f[1]!==s[1]||f[2]!==s[2]||f[3]);if(v||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),void 0!==a.withCredentials&&(r.withCredentials=a.withCredentials),a.contentType!==!1&&void 0!==a.contentType&&r.setRequestHeader("Content-Type",a.contentType),a.dataType){var y={json:"application/json, text/javascript, */*; q=0.01",xml:"application/xml, text/xml, */*; q=0.01"};r.setRequestHeader("Accept",y[a.dataType]||"*/*")}for(var w in a.headers)r.setRequestHeader(w,a.headers[w]);return r.onload=p("success"),r.onerror=p("error"),r.send(l),new e.XHR(r)},t.parallel=function(e,a,r,n){var s=0,o=[],c=[],u=[];n=n||{};var i=function(){if(++s>=a.length&&r){if(n.includeErrors!==!0)for(var e=0;e<c.length;e++)u.indexOf(c[e])>-1&&(c.splice(e,1),o.splice(e,1),e--);r(o,c)}};a.forEach(function(a,r){var s,d,p={};for(s in e)p[s]=e[s];for(s in a)p[s]=a[s];var l=p.success;p.success=function(e){l&&l.apply(null,arguments),o[r]=e,c[r]=d,i()};var f=p.error;p.error=function(e){f&&f.apply(null,arguments),o[r]=e,c[r]=d,u.push(d),n.alwaysExecute&&i()},d=t.ajax(p)})},t});